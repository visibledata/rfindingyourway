<!DOCTYPE html>
<html lang="en-us">

  <head>


    <script src="https://kit.fontawesome.com/f69ee05783.js"></script>



    <meta charset="utf-8">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>One weird regex matches 97% of DOI...</title>
    <meta name="author" content="" />

    
    <meta name="keywords" content="devows, hugo, go">
    

    
    <meta name="description" content="This one weird regex matches 97% of DOI...">
    

    <meta name="generator" content="Hugo 0.56.0" />

    <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    
    <link href="../../../../../css/animate.css" rel="stylesheet">

    
    
    <link href="../../../../../css/style.default.css" rel="stylesheet" id="theme-stylesheet">
    


    
    <link href="../../../../../css/custom.css" rel="stylesheet">

    
    
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

    
    <link rel="shortcut icon" href="../../../../../img/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../img/apple-touch-icon.png" />
    

    <link href="../../../../../css/owl.carousel.css" rel="stylesheet">
    <link href="../../../../../css/owl.theme.css" rel="stylesheet">

    <link rel="alternate" href="../../../../../index.xml" type="application/rss+xml" title="Visible Data">

    
    <meta property="og:title" content="One weird regex matches 97% of DOI..." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="/blog/2019/03/13/2019-03-13_extracting-doi-from-text//" />
    <meta property="og:image" content="img/logo.png" />

    
    <script src="../../../../../js/backported-popover.js"></script>

</head>

  
  <meta name="twitter:site" content="@martinjhnhadley">
<meta name="twitter:creator" content="@martinjhnhadley">

<meta name="twitter:description" content="At least once a month I’m tasked with something that involves working with DOI, but I’ve never bothered to write a function for extracting these from texts. Time to end that by putting together a tidyversesque add_doi() function!
… wait, why?
The R for Data Science book has lots of excellent advice, including this snippet about reducing duplicated code by writing functions:
So, what are DOI? DOI (Digital Object Identifiers) are the gold standard for citations." />
<meta name="twitter:title" content="One weird regex matches 97% of DOI..." />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.visibledata.co.uk/img/blog-images/header-images/2019-03-13_extracting-doi-from-text.png" /> 

  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="../../../../../">
                    <img src="../../../../../img/logo.png" alt="One weird regex matches 97% of DOI... logo" class="hidden-xs hidden-sm">
                    <img src="../../../../../img/logo-small.png" alt="One weird regex matches 97% of DOI... logo" class="visible-xs visible-sm">
                    <span class="sr-only">One weird regex matches 97% of DOI... - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="../../../../../r-timelines/">R Timelines</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Training <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      
                        <li><a href="../../../../../in-person-training/">In-Person Training</a></li>
                      
                        <li><a href="../../../../../online-training/">Online Training</a></li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="../../../../../consultancy/">Consultancy</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="../../../../../blog/">Blog</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="../../../../../about/">About</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>One weird regex matches 97% of DOI...</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">By <a href="#">Martin John Hadley</a> | March 13, 2019</p>

                        <div id="post-content">
                          


<p>At least once a month I’m tasked with something that involves working with DOI, but I’ve never bothered to write a function for extracting these from texts. Time to end that by putting together a tidyversesque <code>add_doi()</code> function!</p>
<p>… wait, why?</p>
<p>The <a href="https://r4ds.had.co.nz/functions.html">R for Data Science</a> book has lots of excellent advice, including this snippet about reducing duplicated code by writing functions:</p>
<p><img src="../../../../../blog/2019-03-13_extracting-doi-from-text_files/when-to-write-a-function.png" alt="&quot;&quot;" width="550" /></p>
<p>So, what are DOI? DOI (Digital Object Identifiers) are the gold standard for citations. They’re guaranteed to point directly to the resource you care about. But how can we reliably extracting DOI from, for example, the following references?</p>
<pre class="r"><code>library(&quot;tidyverse&quot;)
example_references &lt;- tibble(
  text_citation = c(&#39;Gueorgi Kossinets and Duncan J. Watts, &quot;Origins of Homophily in an Evolving Social Network,&quot; American Journal of Sociology 115 (2009):414, accessed December 5, 2014, doi:10.1086/599247&#39;,
                        &#39;Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; Morey, R. D. (2015). The color-sharing bonus: Roles of perceptual organization and attentive processes in visual working memory. Archives of Scientific Psychology, 3, 18–29. https://doi.org/10.1037/arc0000014&#39;,
                        &#39;Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtual collaborative experimentation:
an approach combining remote and local labs. IEEE Transactions on Education. 51 (2),
242–250. Available from: doi:10.1109/TE.2007.908071&#39;))</code></pre>
<p>CrossRef have a great blogpost about how to <a href="https://www.crossref.org/blog/dois-and-matching-regular-expressions/">match DOIs using regular expressions</a> where they recommend the following regex, which matches 97% of the 74.9 million DOI they tested. The majority of the ~500,000 not matched by this regex are from the <em>bad old days</em> of the early noughties, and outside of our interest.</p>
<pre class="r"><code>doi_regex &lt;- &quot;10.\\d{4,9}/[-._;()/:a-z0-9A-Z]+&quot;</code></pre>
<p>Using <code>str_extract()</code> from the tidyverse package <code>stringr</code> allows us to extract the DOIs from our reference:</p>
<pre class="r"><code>example_references %&gt;%
  mutate(doi = str_extract(text_citation, doi_regex))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   text_citation                                            doi             
##   &lt;chr&gt;                                                    &lt;chr&gt;           
## 1 &quot;Gueorgi Kossinets and Duncan J. Watts, \&quot;Origins of Ho… 10.1086/599247  
## 2 Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; Morey, … 10.1037/arc0000…
## 3 &quot;Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtual c… 10.1109/TE.2007…</code></pre>
<p>This can all be rolled together into a function; <code>add_doi()</code>. If you’re unfamiliar with <code>!!</code>, <code>enquo</code> and <code>:=</code> that’s because I’m using <code>tidyeval</code>, <a href="https://tidyeval.tidyverse.org/modifying-inputs.html">find out more about tidyeval here</a>.</p>
<pre class="r"><code>add_doi &lt;- function(.data, citation_column, name = &quot;doi&quot;) {
  citation_column &lt;- enquo(citation_column)

  if (name != &quot;n&quot; &amp;&amp; name %in% colnames(.data)) {
    rlang::abort(glue::glue(&quot;Column `{name}` already exists in the data&quot;))
  }
  
  .data %&gt;%
    mutate(!!name := str_extract(!!citation_column, &quot;10.\\d{4,9}/[-._;()/:a-z0-9A-Z]+&quot;))
}</code></pre>
<p>Because the function is written with <code>tidyeval</code> I can use <em>naked column names</em> just as a I would with <code>dplyr::add_count()</code>:</p>
<pre class="r"><code>example_references %&gt;%
  add_doi(text_citation, &quot;extracted_doi&quot;)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   text_citation                                         extracted_doi      
##   &lt;chr&gt;                                                 &lt;chr&gt;              
## 1 &quot;Gueorgi Kossinets and Duncan J. Watts, \&quot;Origins of… 10.1086/599247     
## 2 Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; More… 10.1037/arc0000014 
## 3 &quot;Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtua… 10.1109/TE.2007.90…</code></pre>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "visibledata-co-uk" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="../../../../../categories/data-scraping">data-scraping (1)</a>
            </li>
            
            <li><a href="../../../../../categories/dataviz">dataviz (5)</a>
            </li>
            
            <li><a href="../../../../../categories/gis">gis (1)</a>
            </li>
            
            <li><a href="../../../../../categories/meta">meta (6)</a>
            </li>
            
            <li><a href="../../../../../categories/r">r (8)</a>
            </li>
            
            <li><a href="../../../../../categories/reproducibility">reproducibility (1)</a>
            </li>
            
            <li><a href="../../../../../categories/shiny">shiny (2)</a>
            </li>
            
            <li><a href="../../../../../categories/workflow">workflow (1)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="../../../../../tags/dataviz"><i class="fa fa-tags"></i> dataviz</a>
            </li>
            
            <li><a href="../../../../../tags/fun"><i class="fa fa-tags"></i> fun</a>
            </li>
            
            <li><a href="../../../../../tags/gis"><i class="fa fa-tags"></i> gis</a>
            </li>
            
            <li><a href="../../../../../tags/htmlwidgets"><i class="fa fa-tags"></i> htmlwidgets</a>
            </li>
            
            <li><a href="../../../../../tags/list-columns"><i class="fa fa-tags"></i> list-columns</a>
            </li>
            
            <li><a href="../../../../../tags/meta"><i class="fa fa-tags"></i> meta</a>
            </li>
            
            <li><a href="../../../../../tags/parallel-programming"><i class="fa fa-tags"></i> parallel-programming</a>
            </li>
            
            <li><a href="../../../../../tags/r"><i class="fa fa-tags"></i> r</a>
            </li>
            
            <li><a href="../../../../../tags/regular-expressions"><i class="fa fa-tags"></i> regular-expressions</a>
            </li>
            
            <li><a href="../../../../../tags/rmdnews"><i class="fa fa-tags"></i> rmdnews</a>
            </li>
            
            <li><a href="../../../../../tags/shiny"><i class="fa fa-tags"></i> shiny</a>
            </li>
            
            <li><a href="../../../../../tags/shiny-modules"><i class="fa fa-tags"></i> shiny-modules</a>
            </li>
            
            <li><a href="../../../../../tags/stringr"><i class="fa fa-tags"></i> stringr</a>
            </li>
            
            <li><a href="../../../../../tags/teaching"><i class="fa fa-tags"></i> teaching</a>
            </li>
            
            <li><a href="../../../../../tags/web-scraping"><i class="fa fa-tags"></i> web-scraping</a>
            </li>
            
            <li><a href="../../../../../tags/workflow"><i class="fa fa-tags"></i> workflow</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1006724,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<footer id="footer">
    <div class="container">
      
      
  <div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://visibledata-co-uk.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


        
        <div class="col-md-4 col-sm-6">
            <h4>About us</h4>

            Visible Data is a consultancy and technical training company focusing on data science, data visualisation and reproducibility based in Oxford, UK.

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="../../../../../blog/">
                          
                            <img src="../../../../../img/placeholder.png" class="img-responsive" alt="Blogs">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../../../../../blog/">Blogs</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="../../../../../blog/2019/12/01/2019-12-01_draft_advent-calendar-bookdown/">
                          
                            <img src="../../../../../img/placeholder.png" class="img-responsive" alt="XXX Advent Calendar (BOOKDOWN)">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../../../../../blog/2019/12/01/2019-12-01_draft_advent-calendar-bookdown/">XXX Advent Calendar (BOOKDOWN)</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="../../../../../blog/2019/07/09/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/">
                          
                            <img src="../../../../../img/placeholder.png" class="img-responsive" alt="Shiny modules to reduce duplication in apps">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../../../../../blog/2019/07/09/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/">Shiny modules to reduce duplication in apps</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2016 - 2018, Visible Data Ltd; all rights reserved.</p>
            
            <p class="pull-right">
              Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-129199947-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="../../../../../js/hpneo.gmaps.js"></script>
<script src="../../../../../js/gmaps.init.js"></script>
<script src="../../../../../js/front.js"></script>


<script src="../../../../../js/owl.carousel.min.js"></script>


  </body>
</html>
